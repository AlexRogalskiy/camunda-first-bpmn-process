<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="Definitions_0h9hf6z" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="3.1.1">
  <bpmn:collaboration id="Collaboration_0m3tyk0">
    <bpmn:participant id="FirstLessonAssigne" name="Назначение первого урока" processRef="FirstLessonAsignee" />
    <bpmn:participant id="Participant_0qpg0h4" name="External worker JS" />
    <bpmn:messageFlow id="MessageFlow_16a25rs" name="PULL" sourceRef="Participant_0qpg0h4" targetRef="AssigneeLesson" />
  </bpmn:collaboration>
  <bpmn:process id="FirstLessonAsignee" name="Назначение первого урока" isExecutable="true">
    <bpmn:sequenceFlow id="SequenceFlow_0fiwg3k" sourceRef="StartEvent" targetRef="FirstMergeGateWay" />
    <bpmn:sequenceFlow id="SequenceFlow_1fe747e" sourceRef="AssigneeLesson" targetRef="HandleResult" />
    <bpmn:sequenceFlow id="SequenceFlow_13w4yyb" sourceRef="CaclauteTaskProps" targetRef="AssigneeLesson" />
    <bpmn:sequenceFlow id="SequenceFlow_15kiyir" sourceRef="HandleResult" targetRef="LastGateway" />
    <bpmn:exclusiveGateway id="LastGateway">
      <bpmn:incoming>SequenceFlow_15kiyir</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_16kpvqj</bpmn:outgoing>
      <bpmn:outgoing>SequenceFlow_1quhvxi</bpmn:outgoing>
      <bpmn:outgoing>SequenceFlow_19pr64p</bpmn:outgoing>
      <bpmn:outgoing>SequenceFlow_0pilkia</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="SequenceFlow_16kpvqj" name="Finish" sourceRef="LastGateway" targetRef="SucessFinish">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${checkResultResult.nextOperation =='Finish'}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="SequenceFlow_0kckued" sourceRef="FirstMergeGateWay" targetRef="CaclauteTaskProps" />
    <bpmn:exclusiveGateway id="FirstMergeGateWay">
      <bpmn:extensionElements>
        <camunda:executionListener class="bpmn2.storm.backend.delegate.PreDecisionDelegate" event="end" />
      </bpmn:extensionElements>
      <bpmn:incoming>SequenceFlow_0fiwg3k</bpmn:incoming>
      <bpmn:incoming>SequenceFlow_1fi2x9m</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_0kckued</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="SequenceFlow_1quhvxi" name="Again" sourceRef="LastGateway" targetRef="UpdateCounters">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${checkResultResult.nextOperation =='Again'}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="SequenceFlow_1fi2x9m" sourceRef="UpdateCounters" targetRef="FirstMergeGateWay" />
    <bpmn:endEvent id="SucessFinish">
      <bpmn:incoming>SequenceFlow_16kpvqj</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:endEvent id="CycleEnded">
      <bpmn:incoming>SequenceFlow_19pr64p</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:sequenceFlow id="SequenceFlow_19pr64p" name="CycleEnded" sourceRef="LastGateway" targetRef="CycleEnded">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${checkResultResult.nextOperation =='CycleEnded'}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:endEvent id="IncorrectService">
      <bpmn:incoming>SequenceFlow_0pilkia</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:sequenceFlow id="SequenceFlow_0pilkia" name="IncorrectService" sourceRef="LastGateway" targetRef="IncorrectService">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${checkResultResult.nextOperation =='IncorrectService'}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:businessRuleTask id="HandleResult" name="Обработать результат" camunda:asyncBefore="true" camunda:resultVariable="checkResultResult" camunda:decisionRef="checkResult" camunda:mapDecisionResult="singleResult">
      <bpmn:incoming>SequenceFlow_1fe747e</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_15kiyir</bpmn:outgoing>
    </bpmn:businessRuleTask>
    <bpmn:serviceTask id="AssigneeLesson" name="Назначить урок" camunda:asyncBefore="true" camunda:type="external" camunda:topic="AssigneeLesson">
      <bpmn:extensionElements>
        <camunda:executionListener class="bpmn2.storm.backend.delegate.PostExternalTaskDelegate" event="end" />
      </bpmn:extensionElements>
      <bpmn:incoming>SequenceFlow_13w4yyb</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_1fe747e</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:businessRuleTask id="CaclauteTaskProps" name="Вычислить параметры задачи" camunda:asyncBefore="true" camunda:resultVariable="CalculateTaskPropsResult" camunda:decisionRef="CalculateTaskProps" camunda:mapDecisionResult="singleResult">
      <bpmn:extensionElements>
        <camunda:executionListener class="bpmn2.storm.backend.delegate.PostTaskDecisionCalculateDelegate" event="end" />
      </bpmn:extensionElements>
      <bpmn:incoming>SequenceFlow_0kckued</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_13w4yyb</bpmn:outgoing>
    </bpmn:businessRuleTask>
    <bpmn:startEvent id="StartEvent">
      <bpmn:outgoing>SequenceFlow_0fiwg3k</bpmn:outgoing>
    </bpmn:startEvent>
    <bpmn:serviceTask id="UpdateCounters" name="UpdateCounter" camunda:asyncBefore="true" camunda:class="bpmn2.storm.backend.delegate.UpdateCounterDelegate">
      <bpmn:incoming>SequenceFlow_1quhvxi</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_1fi2x9m</bpmn:outgoing>
    </bpmn:serviceTask>
  </bpmn:process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Collaboration_0m3tyk0">
      <bpmndi:BPMNShape id="Participant_1a6om01_di" bpmnElement="FirstLessonAssigne" isHorizontal="true">
        <dc:Bounds x="156" y="108" width="1160" height="394" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ServiceTask_0slljo0_di" bpmnElement="AssigneeLesson">
        <dc:Bounds x="552" y="268" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="StartEvent">
        <dc:Bounds x="197" y="290" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_1fe747e_di" bpmnElement="SequenceFlow_1fe747e">
        <di:waypoint x="652" y="308" />
        <di:waypoint x="757" y="308" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="EndEvent_0ybtrgr_di" bpmnElement="SucessFinish">
        <dc:Bounds x="1205" y="290" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_0fiwg3k_di" bpmnElement="SequenceFlow_0fiwg3k">
        <di:waypoint x="233" y="308" />
        <di:waypoint x="267" y="308" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="245" y="256" width="90" height="20" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_13w4yyb_di" bpmnElement="SequenceFlow_13w4yyb">
        <di:waypoint x="491" y="308" />
        <di:waypoint x="552" y="308" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="BusinessRuleTask_0lx10t6_di" bpmnElement="CaclauteTaskProps">
        <dc:Bounds x="391" y="268" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Participant_1k1k6cm_di" bpmnElement="Participant_0qpg0h4" isHorizontal="true">
        <dc:Bounds x="482" y="530" width="424" height="78" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="MessageFlow_16a25rs_di" bpmnElement="MessageFlow_16a25rs">
        <di:waypoint x="633" y="530" />
        <di:waypoint x="633" y="348" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="634" y="436" width="29" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="BusinessRuleTask_1k3a9u0_di" bpmnElement="HandleResult">
        <dc:Bounds x="757" y="268" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_15kiyir_di" bpmnElement="SequenceFlow_15kiyir">
        <di:waypoint x="857" y="308" />
        <di:waypoint x="918" y="308" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="ExclusiveGateway_09bdr32_di" bpmnElement="LastGateway" isMarkerVisible="true">
        <dc:Bounds x="918" y="283" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_16kpvqj_di" bpmnElement="SequenceFlow_16kpvqj">
        <di:waypoint x="968" y="308" />
        <di:waypoint x="1205" y="308" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1072" y="290" width="30" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="ExclusiveGateway_0fjtkg7_di" bpmnElement="FirstMergeGateWay" isMarkerVisible="true">
        <dc:Bounds x="267" y="283" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_0kckued_di" bpmnElement="SequenceFlow_0kckued">
        <di:waypoint x="317" y="308" />
        <di:waypoint x="391" y="308" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_1quhvxi_di" bpmnElement="SequenceFlow_1quhvxi">
        <di:waypoint x="943" y="283" />
        <di:waypoint x="943" y="172" />
        <di:waypoint x="652" y="172" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="689" y="154" width="28" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="ServiceTask_09r3lys_di" bpmnElement="UpdateCounters">
        <dc:Bounds x="552" y="132" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_1fi2x9m_di" bpmnElement="SequenceFlow_1fi2x9m">
        <di:waypoint x="552" y="172" />
        <di:waypoint x="292" y="172" />
        <di:waypoint x="292" y="283" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="EndEvent_0kvbvh1_di" bpmnElement="CycleEnded">
        <dc:Bounds x="1205" y="182" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_19pr64p_di" bpmnElement="SequenceFlow_19pr64p">
        <di:waypoint x="954" y="294" />
        <di:waypoint x="1014" y="216" />
        <di:waypoint x="1205" y="201" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1052" y="193" width="60" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="EndEvent_0rfx78n_di" bpmnElement="IncorrectService">
        <dc:Bounds x="1205" y="388" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_0pilkia_di" bpmnElement="SequenceFlow_0pilkia">
        <di:waypoint x="952" y="324" />
        <di:waypoint x="995" y="394" />
        <di:waypoint x="1205" y="405" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1049" y="368" width="80" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
